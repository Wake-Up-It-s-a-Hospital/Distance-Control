## Distance-Control 기능 요약

1. **UWB 거리 측정**
    - 태그(이동 장치)와 앵커(고정 장치) 사이의 거리를 실시간으로 측정합니다.
    - 정밀한 시간 차이 계산(TWR 방식)으로 cm 단위 거리 산출이 가능합니다.
2. **태그 & 앵커 역할 분리**
    - **태그**: 거리 측정을 시작하는 장치. 주기적으로 신호를 보내고 결과를 수신합니다.
    - **앵커**: 태그 신호를 받아 응답하고, 거리 계산을 수행하여 결과를 전달합니다.
3. **통신 안정성 관리**
    - 통신이 멈추거나 일정 시간 응답이 없으면 자동으로 재시작 또는 재부팅하여 시스템이 멈추지 않게 유지합니다.
4. **노이즈 보정**
    - 앵커 쪽에서 칼만 필터를 적용해 거리값이 튀는 현상을 줄이고 안정된 측정 결과를 제공합니다.
5. **측정 속도 모니터링**
    - 1초에 몇 번 거리 측정이 성공했는지를 계산해 샘플링 속도를 표시합니다.
6. **AWS IoT 연동**
   - **원격 모드 전환**: AWS MQTT 메시지로 태그 모드를 *수동/자동* 변경.
   - **환자 lost 알림**: lost 상황 인지시 부저가 울려 알림.
   - **동기화**:  모드상태를 led 출력상태와 동기화.
# 개요

- **프로토콜**: 태그(Tag) ↔ 앵커(Anchor) 사이에 **POLL → POLL_ACK → RANGE → RANGE_REPORT** 시퀀스로 **쌍방 대칭(TWR) 거리측정**.
- **감시/안정화**: UWB 통신 정지 감지(워치독)와 타임아웃 시 **수신 재시작 또는 리셋**.
- 
## 📂 폴더 구조
Distance-Control/
├── src/
│   ├── dwm1000_tag/           # 태그 펌웨어
│   ├── dwm1000_anchor/        # 앵커 펌웨어
│   ├── wearable_on_aws/       # AWS IoT 연동 코드
│   └── main.cpp               # 예제/테스트 코드
└── platformio.ini             # PlatformIO 빌드 설정


### 앵커 핀맵 (ESP32 ↔ DWM1000)
- **SPI**
    - `PIN_MOSI = 23`
    - `PIN_MISO = 19`
    - `PIN_SCK = 12`
    - `PIN_SS = 14` *(Chip Select)*
- **제어**
    - `PIN_IRQ = 13`
    - `PIN_RST = 15`

### 태그 핀맵 (ESP32 ↔ DWM1000)
- **SPI**
    - `PIN_MOSI = 17`
    - `PIN_MISO = 16`
    - `PIN_SCK = 4`
    - `PIN_SS = 5`
- **제어**
    - `PIN_IRQ = 2`
    - `PIN_RST = 15`

# 작동법
1. **앵커 전원 인가**
    - 시리얼 모니터로 부팅 로그가 뜨는지 확인(보오율115200).
2. **태그 전원 인가**
    - 태그가 폴링(POLL)하고 앵커가 응답하며 **거리 측정값**이 시리얼로 출력됩니다(단위: **m**).
3. **거리 확인**
    - Serial Monitor 에 distance 값이 주기적으로 출력됩니다.


https://github.com/user-attachments/assets/f7d7a565-9695-4982-8655-7eac68f521dd



